{
  "metadata": {
    "projectName": "Top1000",
    "description": "PT站点资源追踪系统（小型个人项目，日请求约100次）",
    "lastUpdated": "2026-01-26T20:07:32+08:00",
    "version": "1.0.0",
    "dockerImageSize": "4.5-5MB",
    "coverage": "100%"
  },
  "modules": [
    {
      "path": "cmd/top1000",
      "name": "程序入口",
      "language": "Go",
      "lines": 18,
      "entryPoint": "main.go",
      "responsibilities": [
        "加载环境变量",
        "启动服务器"
      ],
      "documentation": "cmd/top1000/CLAUDE.md",
      "dependencies": [
        "internal/server",
        "internal/config"
      ]
    },
    {
      "path": "internal/config",
      "name": "配置管理",
      "language": "Go",
      "lines": 115,
      "entryPoint": "config.go",
      "responsibilities": [
        "从环境变量读取配置",
        "启动时验证配置",
        "提供配置访问接口"
      ],
      "documentation": "internal/config/CLAUDE.md",
      "dependencies": [],
      "envVariables": [
        "REDIS_ADDR",
        "REDIS_PASSWORD",
        "REDIS_DB",
        "IYUU_SIGN"
      ]
    },
    {
      "path": "internal/model",
      "name": "数据模型",
      "language": "Go",
      "lines": 78,
      "entryPoint": "types.go",
      "responsibilities": [
        "定义数据结构",
        "提供数据验证"
      ],
      "documentation": "internal/model/CLAUDE.md",
      "dependencies": []
    },
    {
      "path": "internal/api",
      "name": "API处理层",
      "language": "Go",
      "lines": 202,
      "entryPoint": "handlers.go",
      "responsibilities": [
        "处理HTTP请求",
        "实现容错机制",
        "提供Top1000数据接口",
        "提供站点配置接口"
      ],
      "documentation": "internal/api/CLAUDE.md",
      "dependencies": [
        "internal/storage",
        "internal/crawler",
        "internal/config",
        "internal/model"
      ],
      "routes": [
        "/top1000.json",
        "/sites.json"
      ]
    },
    {
      "path": "internal/storage",
      "name": "Redis存储",
      "language": "Go",
      "lines": 311,
      "entryPoint": "redis.go",
      "responsibilities": [
        "管理Redis连接",
        "存储数据",
        "读取数据",
        "检查过期",
        "支持Context传递"
      ],
      "documentation": "internal/storage/CLAUDE.md",
      "dependencies": [
        "internal/config",
        "internal/model"
      ],
      "redisKeys": [
        "top1000:data",
        "top1000:sites"
      ]
    },
    {
      "path": "internal/crawler",
      "name": "数据爬取",
      "language": "Go",
      "lines": 254,
      "entryPoint": "scheduler.go",
      "responsibilities": [
        "从IYUU API获取数据",
        "解析文本数据",
        "预加载数据",
        "支持Context传递"
      ],
      "documentation": "internal/crawler/CLAUDE.md",
      "dependencies": [
        "internal/config",
        "internal/model",
        "internal/storage"
      ],
      "apiEndpoints": [
        "https://api.iyuu.cn/top1000.php"
      ]
    },
    {
      "path": "internal/server",
      "name": "HTTP服务器",
      "language": "Go",
      "lines": 176,
      "entryPoint": "server.go",
      "responsibilities": [
        "配置Fiber应用",
        "配置中间件和路由",
        "初始化Redis",
        "启动时预加载数据",
        "配置安全响应头"
      ],
      "documentation": "internal/server/CLAUDE.md",
      "dependencies": [
        "internal/config",
        "internal/api",
        "internal/storage",
        "internal/crawler"
      ]
    },
    {
      "path": "web",
      "name": "前端应用",
      "language": "TypeScript",
      "entryPoint": "src/main.ts",
      "responsibilities": [
        "AG Grid表格展示",
        "站点配置动态加载",
        "用户交互"
      ],
      "documentation": "web/CLAUDE.md",
      "dependencies": [],
      "techStack": [
        "Vite 8.0.0-beta.5",
        "AG Grid Community 35.0.0",
        "TypeScript 5.9.3",
        "pnpm 10.12.4+"
      ],
      "keyFiles": [
        "src/main.ts",
        "src/gridConfig.ts",
        "src/utils/config.ts",
        "src/utils/operationRender.ts"
      ]
    }
  ],
  "techStack": {
    "backend": {
      "language": "Go",
      "version": "1.25.5",
      "framework": "Fiber",
      "frameworkVersion": "v2.52.10",
      "database": "Redis 5.0+"
    },
    "frontend": {
      "language": "TypeScript",
      "version": "5.9.3",
      "framework": "Vite",
      "frameworkVersion": "8.0.0-beta.5",
      "uiLibrary": "AG Grid Community",
      "uiVersion": "35.0.0",
      "packageManager": "pnpm",
      "packageVersion": "10.12.4+"
    },
    "deployment": {
      "container": "Docker",
      "baseImage": "Scratch",
      "imageSize": "4.5-5MB (UPX压缩)",
      "port": 7066,
      "ci": "GitHub Actions"
    }
  },
  "externalDependencies": {
    "redis": {
      "required": true,
      "purpose": "数据存储 + 过期检测",
      "poolSize": 3,
      "storageStrategy": "永久存储（不设置TTL）",
      "updateThreshold": "24小时"
    },
    "iyuuApi": {
      "top1000": {
        "url": "https://api.iyuu.cn/top1000.php",
        "timeout": "15秒",
        "updateStrategy": "按需更新（过期才拉）"
      },
      "sites": {
        "url": "https://api.iyuu.cn/index.php",
        "auth": "需要IYUU_SIGN",
        "ttl": "24小时"
      }
    }
  },
  "fileStructure": {
    "goModules": [
      "cmd/top1000/main.go",
      "internal/api/handlers.go",
      "internal/config/config.go",
      "internal/crawler/scheduler.go",
      "internal/model/types.go",
      "internal/server/server.go",
      "internal/storage/redis.go"
    ],
    "frontendSource": [
      "web/src/main.ts",
      "web/src/gridConfig.ts",
      "web/src/types.d.ts",
      "web/src/utils/config.ts",
      "web/src/utils/operationRender.ts",
      "web/src/utils/index.ts",
      "web/src/index.css"
    ],
    "configFiles": [
      "go.mod",
      ".env.example",
      ".air.toml",
      "Dockerfile",
      "docker-compose.yaml",
      "web/package.json",
      "web/vite.config.ts"
    ]
  },
  "statistics": {
    "totalGoLines": 1154,
    "totalModules": 8,
    "goModules": 7,
    "frontendModules": 1,
    "documentationCoverage": "100%",
    "ignoredPatterns": [
      "node_modules/**",
      ".git/**",
      ".github/**",
      "dist/**",
      "build/**",
      ".next/**",
      "__pycache__/**",
      "*.lock",
      "*.log",
      "*.bin",
      "*.pdf",
      "*.png",
      "*.jpg",
      "*.jpeg",
      "*.gif",
      "*.mp4",
      "*.zip",
      "*.tar",
      "*.gz",
      "web-dist/**",
      "tmp/**"
    ]
  },
  "changelog": [
    {
      "date": "2026-01-26",
      "version": "1.0.0",
      "changes": [
        "重大更新：站点配置动态加载",
        "新增: /sites.json API接口",
        "新增: IYUU_SIGN 环境变量配置",
        "优化: 前端启动时自动加载站点配置",
        "优化: 操作列渲染器改为动态查询站点配置",
        "移除: 前端硬编码的iyuuSites.ts文件（118个站点配置）",
        "优化: Context支持全面覆盖（API、Storage、Crawler）",
        "优化: 时区处理修复（北京时间UTC+8转UTC）"
      ]
    },
    {
      "date": "2026-01-20",
      "version": "0.9.0",
      "changes": [
        "初始化项目文档",
        "完成模块划分和文档生成"
      ]
    }
  ],
  "gaps": [],
  "nextSteps": [
    "所有模块已完成扫描和文档化",
    "文档覆盖率100%",
    "无缺口需要补充"
  ]
}
